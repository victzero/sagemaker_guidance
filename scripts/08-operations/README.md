# 08-operations - è¿ç»´æ“ä½œè„šæœ¬

å¹³å°éƒ¨ç½²å®Œæˆåçš„æ—¥å¸¸è¿ç»´æ“ä½œè„šæœ¬ã€‚

> ğŸ“– **è¯¦ç»†æ–‡æ¡£**: [docs/16-operations.md](../../docs/16-operations.md)

---

## æ¶æ„è®¾è®¡

æœ¬æ¨¡å—å¤ç”¨ `scripts/lib/` ä¸­çš„å·¥å‚å‡½æ•°ï¼Œç¡®ä¿ä¸åˆå§‹éƒ¨ç½²è„šæœ¬è¡Œä¸ºä¸€è‡´ï¼š

```
08-operations/
    â†“ è°ƒç”¨
scripts/lib/
â”œâ”€â”€ discovery.sh         # åŠ¨æ€èµ„æºå‘ç° (ä» AWS å®æ—¶æŸ¥è¯¢)
â”œâ”€â”€ iam-core.sh          # IAM åˆ›å»º (å¤ç”¨ 01-iam æ¨¡æ¿)
â”œâ”€â”€ s3-factory.sh        # S3 åˆ›å»º
â””â”€â”€ sagemaker-factory.sh # Profile/Space åˆ›å»º
```

### åŠ¨æ€å‘ç° vs é™æ€é…ç½®

| è„šæœ¬ç±»å‹ | èµ„æºå‘ç°æ–¹å¼ | é€‚ç”¨åœºæ™¯ |
|---------|-------------|---------|
| **01-07 åˆå§‹åŒ–** | `.env` é…ç½®æ–‡ä»¶ | å£°æ˜å¼æ‰¹é‡éƒ¨ç½²åŸºç¡€è®¾æ–½ |
| **08 è¿ç»´è„šæœ¬** | åŠ¨æ€å‘ç° (AWS API) | äº¤äº’å¼æ—¥å¸¸è¿ç»´æ“ä½œ |

**è¿ç»´è„šæœ¬ç‰¹æ€§**:
- ğŸ”„ å›¢é˜Ÿ/é¡¹ç›®åˆ—è¡¨ä» IAM Groups å®æ—¶æŸ¥è¯¢ (`discover_teams()`, `discover_projects_for_team()`)
- âœ… æ–°å¢èµ„æºåç«‹å³å¯è§ï¼Œæ— éœ€æ›´æ–°é…ç½®
- ğŸ›¡ï¸ åŸºäºçœŸå®ç¯å¢ƒçŠ¶æ€æ“ä½œï¼Œé¿å…é…ç½®ä¸ä¸€è‡´

> **æ³¨æ„**: `.env.shared` ä»ç”¨äº `get_team_fullname()` æ˜ å°„å‡½æ•°ï¼Œå»ºè®®æ–°å¢å›¢é˜Ÿåæ›´æ–°é…ç½®ä»¥ä¾¿æ˜¾ç¤ºå‹å¥½åç§°ã€‚

---

## ç›®å½•ç»“æ„

```
08-operations/
â”œâ”€â”€ 00-init.sh                        # åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ user/                             # ç”¨æˆ·ç®¡ç†
â”‚   â”œâ”€â”€ add-user.sh                   # æ–°å¢ç”¨æˆ·åˆ°é¡¹ç›®
â”‚   â”œâ”€â”€ add-user-to-project.sh        # å·²æœ‰ç”¨æˆ·åŠ å…¥æ–°é¡¹ç›®
â”‚   â”œâ”€â”€ remove-user-from-project.sh   # ä»é¡¹ç›®ç§»é™¤ç”¨æˆ·
â”‚   â”œâ”€â”€ delete-user.sh                # å®Œå…¨åˆ é™¤ç”¨æˆ·
â”‚   â””â”€â”€ set-user-download-access.sh   # ç®¡ç†æ–‡ä»¶ä¸‹è½½æƒé™
â”œâ”€â”€ project/                          # é¡¹ç›®ç®¡ç†
â”‚   â”œâ”€â”€ add-project.sh                # æ–°å¢é¡¹ç›®
â”‚   â””â”€â”€ delete-project.sh             # åˆ é™¤é¡¹ç›®
â”œâ”€â”€ team/                             # å›¢é˜Ÿç®¡ç†
â”‚   â”œâ”€â”€ add-team.sh                   # æ–°å¢å›¢é˜Ÿ
â”‚   â””â”€â”€ delete-team.sh                # åˆ é™¤å›¢é˜Ÿ
â””â”€â”€ query/                            # æŸ¥è¯¢å·¥å…·
    â”œâ”€â”€ list-users.sh                 # åˆ—å‡ºç”¨æˆ·
    â””â”€â”€ list-projects.sh              # åˆ—å‡ºé¡¹ç›®
```

---

## å¿«é€Ÿå¼€å§‹

```bash
cd scripts/08-operations

# æ–°å¢é¡¹ç›®
./project/add-project.sh

# æ–°å‘˜å·¥å…¥èŒ
./user/add-user.sh

# è·¨é¡¹ç›®åä½œ
./user/add-user-to-project.sh

# æŸ¥è¯¢
./query/list-users.sh
./query/list-projects.sh
```

---

## èµ„æºåˆ›å»ºè¯¦æƒ…

### add-project.sh

| èµ„æºç±»å‹     | æ•°é‡ | è¯´æ˜                                       |
| ------------ | ---- | ------------------------------------------ |
| IAM Group    | 1    | `sagemaker-{team}-{project}`               |
| IAM Policies | 11   | å®Œæ•´ç­–ç•¥é›†ï¼Œå« Deny è·¨é¡¹ç›®                 |
| IAM Roles    | 4    | Execution, Training, Processing, Inference |
| S3 Bucket    | 1    | å¯é€‰ï¼Œæ ‡å‡†ç›®å½•ç»“æ„                         |

### add-user.sh / add-user-to-project.sh

| èµ„æºç±»å‹         | è¯´æ˜                                  |
| ---------------- | ------------------------------------- |
| IAM User         | (ä»… add-user) å¸¦ Permissions Boundary |
| Group Membership | åŠ å…¥å›¢é˜Ÿç»„ + é¡¹ç›®ç»„                   |
| User Profile     | ç»‘å®šé¡¹ç›® Execution Role               |
| Private Space    | 50GB EBS                              |

---

## å®‰å…¨æœºåˆ¶

- **æ‰€æœ‰æ“ä½œ**: æ‰§è¡Œå‰æ˜¾ç¤ºèµ„æºæ¸…å•ï¼Œéœ€ç¡®è®¤
- **åˆ é™¤æ“ä½œ**: éœ€ä¸¤æ¬¡ç¡®è®¤ï¼ˆè¾“å…¥èµ„æºåç§°ï¼‰
- **æƒé™éš”ç¦»**: æ–°é¡¹ç›®è‡ªåŠ¨åŒ…å« Deny è·¨é¡¹ç›®ç­–ç•¥
